%%%===================================================================
%%% @doc
%%% @end
%%%===================================================================
-module(arweave_config_global_data_directory).
-behavior(arweave_config_spec).
-export([
	configuration_key/0,
	default/0,
	required/0,
	legacy/0,
	runtime/0,
	environment/0,
	short_argument/0,
	long_argument/0,
	short_description/0,
	long_description/0,
	elements/0,
	type/0,
	check/1,
	handle_get/1,
	handle_set/3
]).
-include_lib("kernel/include/logger.hrl").

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
configuration_key() -> [global, data, directory].

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
runtime() -> false.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
required() -> true.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
default() -> ".".

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
legacy() -> [data_dir].

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
short_description() -> <<"Configure Arweave data directory.">>.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
long_description() -> <<"">>.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
environment() -> <<"AR_DATA_DIRECTORY">>.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
short_argument() -> $D.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
long_argument() -> [data, directory].

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
elements() -> 1.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
type() -> path.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
check(Path) -> 
	case filelib:is_dir(Path) of
		true -> ok;
		false -> {error, not_directory}
	end.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
handle_get(Key) ->
	Return = arweave_config_store:get(Key),
	{ok, Return}.

%%--------------------------------------------------------------------
%%
%%--------------------------------------------------------------------
handle_set(Key, Value, OldValue) ->
	?LOG_INFO("~p is a read only value, it cannot be set", [{Key, Value, OldValue}]),
	{error, #{ reason => read_only }}
