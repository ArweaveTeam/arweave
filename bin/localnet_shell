#!/usr/bin/env bash

SCRIPT_DIR="$(dirname "$0")"
cd "$SCRIPT_DIR/.."

./ar-rebar3 localnet compile

if [ "$(uname -s)" == "Darwin" ]; then
    RANDOMX_JIT="disable randomx_jit"
else
    RANDOMX_JIT=
fi

export ERL_EPMD_ADDRESS=127.0.0.1

ERL_LOCALNET_OPTS="-pa $(./rebar3 as localnet path) $(./rebar3 as localnet path --base)/lib/arweave/test -config config/sys.config"
echo -e "\033[0;32m===> Starting localnet shell from localnet_snapshot...\033[0m"

# Check if BEAM process is running
if pgrep -f "beam.smp" > /dev/null; then
    echo "BEAM is already running. Exiting."
    exit 1
else
    erl $ERL_LOCALNET_OPTS -name main-localnet@127.0.0.1 -setcookie localnet -noshell -s ar shell_localnet -s shell start_interactive 2>&1
fi
kill 0

